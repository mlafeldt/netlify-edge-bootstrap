/* esm.sh - @netlify/cache@1.7.1/dist/bootstrap/main */
var m=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},s=(e,t,a)=>(m(e,t,"read from private field"),a?a.call(e):t.get(e)),n=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},c=(e,t,a,r)=>(m(e,t,"write to private field"),r?r.call(e,a):t.set(e,a),a),E=(e=>(e.Delete="delete",e.Read="read",e.Write="write",e))(E||{}),S={invalid_vary:"Responses must not use unsupported directives of the `Netlify-Vary` header (https://ntl.fyi/cache_api_invalid_vary).",no_cache:"Responses must not set cache control headers with the `private`, `no-cache` or `no-store` directives (https://ntl.fyi/cache_api_no_cache).",low_ttl:"Responses must have a cache control header with a `max-age` or `s-maxage` directive (https://ntl.fyi/cache_api_low_ttl).",no_directive:"Responses must have a cache control header with caching directives (https://ntl.fyi/cache_api_no_directive).",no_ttl:"Responses must have a cache control header with a `max-age` or `s-maxage` directive (https://ntl.fyi/cache_api_no_ttl).",no_status:"Responses must specify a status code (https://ntl.fyi/cache_api_no_status).",invalid_directive:"Responses must have a cache control header with caching directives (https://ntl.fyi/cache_api_invalid_directive).",status:"Responses must have a status code between 200 and 299 (https://ntl.fyi/cache_api_status)."},C="The server has returned an unexpected error (https://ntl.fyi/cache_api_error).",T="netlify-programmable-error",$="netlify-programmable-headers",k="netlify-programmable-status",x="netlify-programmable-store",U="netlify-forwarded-host",L="user-agent",_=new Set(["http:","https:"]),M=new Set(["cookie","content-encoding","content-length"]),d=Symbol("getInternalHeaders"),y=Symbol("serializeResourceHeaders"),p,i,u,l,N=class{constructor({base64Encode:e,getContext:t,name:a,userAgent:r}){n(this,p,void 0),n(this,i,void 0),n(this,u,void 0),n(this,l,void 0),c(this,p,e),c(this,i,t),c(this,u,a),c(this,l,r)}[d](e){let{host:t,token:a}=e,r={Authorization:`Bearer ${a}`,[x]:s(this,u)};return t&&(r[U]=t),s(this,l)&&(r[L]=s(this,l)),r}[y](e){let t={};return e.forEach((a,r)=>{M.has(r)||(r==="set-cookie"?(t[r]=t[r]||[],t[r].push(a)):t[r]=a.split(","))}),s(this,p).call(this,JSON.stringify(t))}async add(e){await this.put(new Request(e),await fetch(e))}async addAll(e){await Promise.allSettled(e.map(t=>this.add(t)))}async delete(e){let t=s(this,i).call(this,{operation:"delete"});if(t){let a=f(e);await fetch(`${t.url}/${w(a)}`,{headers:this[d](t),method:"DELETE"})}return!0}async keys(e){return[]}async match(e){try{let t=s(this,i).call(this,{operation:"read"});if(!t)return;let a=f(e),r=`${t.url}/${w(a)}`,h=await fetch(r,{headers:this[d](t),method:"GET"});return h.ok?h:void 0}catch{}}async matchAll(e,t){if(!e)return[];let a=await this.match(e);return a?[a]:[]}async put(e,t){if(!t.ok)throw new TypeError(`Cannot cache response with status ${t.status}.`);if(e instanceof Request&&e.method!=="GET")throw new TypeError(`Cannot cache response to ${e.method} request.`);if(t.status===206)throw new TypeError("Cannot cache response to a range request (206 Partial Content).");if(t.headers.get("vary")?.includes("*"))throw new TypeError("Cannot cache response with 'Vary: *' header.");let a=s(this,i).call(this,{operation:"write"});if(!a)return;let r=f(e),h=await fetch(`${a.url}/${w(r)}`,{body:t.body,headers:{...this[d](a),[$]:this[y](t.headers),[k]:t.status.toString()},duplex:"half",method:"POST"});if(!h.ok){let R=h.headers.get(T)??"",g=S[R]||C;a.logger?.(`Failed to write to the cache: ${g}`)}}};p=new WeakMap;i=new WeakMap;u=new WeakMap;l=new WeakMap;var f=e=>{let t;if(e instanceof Request)t=new URL(e.url);else try{t=new URL(String(e))}catch{throw new TypeError(`${e} is not a valid URL.`)}if(!_.has(t.protocol))throw new TypeError(`Cannot cache response for URL with unsupported protocol (${t.protocol}). Supported protocols are ${[..._].join(", ")}.`);return t},w=e=>encodeURIComponent(e.toString()),v,o,P=class{constructor(e){n(this,v,void 0),n(this,o,void 0),c(this,v,e),c(this,o,new Map)}open(e){let t=s(this,o).get(e);return t||(t=new N({...s(this,v),name:e}),s(this,o).set(e,t)),Promise.resolve(t)}has(e){return Promise.resolve(s(this,o).has(e))}delete(e){return Promise.resolve(s(this,o).delete(e))}keys(){return Promise.resolve([...s(this,o).keys()])}async match(e,t){if(t?.cacheName)return s(this,o).get(t.cacheName)?.match(e);for(let a of s(this,o).values())if(await a.match(e)===void 0)return}};v=new WeakMap;o=new WeakMap;export{N as NetlifyCache,P as NetlifyCacheStorage,E as Operation};
//# sourceMappingURL=main.mjs.map